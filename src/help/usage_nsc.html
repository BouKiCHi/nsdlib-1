<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<HTML>
<HEAD>
<meta name="GENERATOR" content="Microsoft&reg; HTML Help Workshop 4.1">
<meta http-equiv='Content-Type' content='text/html;charset=Shift_JIS'>
<meta http-equiv='Content-Style-Type' content='text/css'>
<link rel="stylesheet" type="text/css" href="help.css">
<Title>MMLコンパイラ（nsc.exe）</Title>
</HEAD>
<BODY>

<div id='contents'>
<h1>NSDL（NES Sound Driver Library）</h1>
<h2>MMLコンパイラ（nsc.exe）</h2>

<div class='block'>
<h3>コマンドラインオプション（Command line option）</h3>
<p>
テキストで記述されたMMLファイルを、本音源ドライバーNSD.Lib用のデータに変換します。<br>
デフォルトでは、何も出力しません。何か、コマンドラインオプションを指定して下さい。<br>
</p>
<p>
アセンブリ言語・Ｃ言語用のソース（配列変数定義）で出力したファイルは、
単体でオブジェクトファイルに、コンパイル ＆ アセンブル可能となっています<strong>（未実装）</strong>。<br>
ユーザー・アプリケーションのビルドの際に、そのオブジェクト・ファイルをリンクして下さい。<br>
</p>
<p>
また、NSFファイルへのコンパイルも可能です。<br>
複数の曲に対応していますが、コンパイラで直接ＮＳＦを生成する場合は、
曲データは合計で24kByte以内、⊿ＰＣＭを使う場合は16kByte以内となります。<br>
<strong>現状は、ＮＳＦへのコンパイルのみ対応しています。</strong>
</p>
<code><pre>
	nsc <var>-option</var> <var>MML-file name</var>
</pre></code>
<dl>
<dt>-h</dt><dd>Print the help.</dd>
<dt>-n</dt><dd>Output the NSF. (*.nsf) </dd>
<dt>-c</dt><dd>Output the C language source file for cc65. (*.c)<strong>未実装</strong></dd>
<dt>-s</dt><dd>Output the assembly language source file for ca65. (*.s) (default)<strong>未実装</strong></dd>
<dt>-b</dt><dd>Output the Binary file. (*.bin)</dd>
<dt>-fn<var>filename</var></dt><dd>Set the file name of NSF.</dd>
<dt>-fc<var>filename</var></dt><dd>Set the file name of C language source file.</dd>
<dt>-fs<var>filename</var></dt><dd>Set the file name of assembly language source file.</dd>
<dt>-fb<var>filename</var></dt><dd>Set the file name of binary file.</dd>
</dl>
</div>

<div class='block'>
<h3>ＭＭＬ文法（Syntax of MML）</h3>
<h4><a href="mml.html#construction">全体の構文</a></h4>
<p>
MMLの構文は、`#'で始まる定義命令・疑似命令及び、<br>
データ（エンベロープパターン、シーケンスデータ）を記述する記述ブロックで構成されます。
</p>
<h4><a href="mml.html#envelop">エンベロープパターン</a></h4>
<p>
音色、音量、周波数、音程の推移パターンを定義します。<br>
</p>
<h4><a href="mml.html#sequence">シーケンスデータ</a></h4>
<p>
BGM,SE,サブルーチンの演奏パターンを定義します。<br>
</p>
</div>


<div class='block'>
<h3>バイナリファイル・ＮＳＦの配置仕様</h3>
<p>
データは、6502のアドレス空間 0x8000 番地を先頭に配置されることを想定しています。<br>
ＮＳＦヘッダーをのぞき、ファイル先頭に、以下テーブルの情報がファイル先頭にあります。<br>
</p>
<table>
<tr><th>Address			</th><th>内容					</td></tr>
<tr><td>0x8000			</td><td>BGMデータ数			</td></tr>
<tr><td>0x8001			</td><td>SE データ数			</td></tr>
<tr><td>0x8002～0x8003	</td><td>⊿PCM構造体のアドレス（）	</td></tr>
<tr><td>0x8004～0x8005	</td><td>BGM(0)番の先頭アドレス		</td></tr>
<tr><td>・・・			</td><td>・・・						</td></tr>
<tr><td>・・・			</td><td>SE(0)番の先頭アドレス		</td></tr>
<tr><td>～0xBFFF		</td><td>データ実体					</td></tr>
<tr><td>0xC000～0xDFFF	</td><td>⊿PCMデータ実体			</td></tr>
<tr><td>0xE000～0xFFFF	</td><td>実行コード ＆ 割り込みベクタ</td></tr>
</table>
</div>


<div class='block'>
<h3>Ｃ言語・アセンブリ言語ソースの仕様</h3>
<p>
<strong>未実装！</strong>
</p>
<h4>曲データのシンボル（ラベル）</h4>
<p>
曲データのシンボルは、<var>_nsd_ファイル名_番号</var>となります。<br>
（Ｃ言語の場合は、<var>nsd_ファイル名_番号</var>となります。）<br>
このシンボルのポインタを引数に、<a href="func_nsd_play_bgm.html">nsd_play_bgm()関数</a>を呼び出すことで、その曲データが再生されます。<br>
曲データは、6502のメモリ空間にさえ存在していれば（バンクがセレクトされていれば）、どこに配置されていても再生可能です。<br>
</p>
<p>
例えば、ファイル名が<var>foo</var>で、MMLファイル中の２番目の曲データは、
<code>_nsd_foo_2</code>と命名され、<code>.export</code>宣言されます。<br>
ユーザーアプリケーション側からは、このシンボル名を<code>.import</code>することで、参照が可能になります。<br>
</p>
</div>

</div>

</BODY>
</HTML>
